<div class="w-full py-4 px-4 border-b border-gray-400">
    <h1 class="text-2xl font-bold uppercase text-center text-purple-700">Datos principales de la reunión</h1>
</div>

<div class="w-full px-4 mt-8">
    <form [formGroup]="reunionForm" (ngSubmit)="crearReunion()">
        <mat-form-field class="w-full">
            <mat-label>Nombre de la reunión</mat-label>
            <input matInput formControlName="nombre">
        </mat-form-field>

        <mat-form-field class="w-full">
            <mat-label>Lugar de la reunión</mat-label>
            <input matInput formControlName="lugar">
        </mat-form-field>

        @if(proyectos.length > 0) {
            <mat-form-field class="w-full">
                <mat-label>Proyecto</mat-label>
                <input type="text"
                    placeholder="Selecciona un proyecto"
                    aria-label="Proyecto"
                    matInput
                    formControlName="id_proyecto"
                    [matAutocomplete]="auto"
                >
                <mat-autocomplete 
                    #auto="matAutocomplete" 
                    [displayWith]="displayProyectoNombre"
                    (optionSelected)="ObtenerVersiones(
                        reunionForm.controls['id_proyecto'].value?.id ?? 0
                    )"
                >
                    @for (proyecto of proyectosFiltrados | async ; track $index) {
                        <mat-option [value]="proyecto">{{ proyecto.nombre }}</mat-option>
                    }
                </mat-autocomplete>
            </mat-form-field>
        }


        <mat-form-field class="w-full">
            <mat-label>Versión</mat-label>
            <input type="text"
                placeholder="Selecciona una versión"
                aria-label="version"
                matInput
                formControlName="id_version"
                [matAutocomplete]="auto"
                [disabled]="reunionForm.controls['id_proyecto'].value === null"
            >
            <mat-autocomplete 
                #auto="matAutocomplete" 
                [displayWith]="displayVersionNombre"
            >
                @for (version of versionesFiltradas | async ; track $index) {
                    <mat-option [value]="version">{{ version.nombre }}</mat-option>
                }
            </mat-autocomplete>
        </mat-form-field>
    

        <!-- <mat-form-field class="w-full">
            <mat-label>Versión</mat-label>
            <mat-select
                [disabled]="reunionForm.controls['id_proyecto'].value === null"
                formControlName="id_version"
                placeholder="Selecciona una versión"
            >
                @for (version of versiones; track $index) {
                    <mat-option [value]="version.id">{{ version.nombre }}</mat-option>
                }
            </mat-select>
        </mat-form-field> -->


        <div class="text-center space-x-4 mb-4 mt-8">
            <button mat-flat-button type="submit" [disabled]="isSubmitting">  
                @if(isSubmitting){
                    <mat-spinner diameter="20" strokeWidth="2"></mat-spinner>
                } @else {
                    <span class="flex items-center gap-2">
                        <mat-icon>check</mat-icon>
                        Crear Reunión 
                    </span>
                }
            </button>
            <button mat-flat-button type="button" class="btn-secondary" (click)="closeDialog(false)">
                <mat-icon>close</mat-icon>
                Cancelar
            </button>
        </div>
    </form>
</div>